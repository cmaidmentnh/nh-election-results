{% extends "base.html" %}

{% block title %}{{ summary.name }} {{ year }} - NH Election Results{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ summary.name }} - {{ year }}</h1>
    <p class="subtitle">
        <a href="{{ url_for('town', name=summary.name) }}">&larr; Back to {{ summary.name }} overview</a>
    </p>
</div>

<!-- Year Navigation -->
<div class="year-nav">
    {% for y in summary.years|reverse %}
    {% if y == year %}
    <span class="active">{{ y }}</span>
    {% else %}
    <a href="{{ url_for('town_year', name=summary.name, year=y) }}">{{ y }}</a>
    {% endif %}
    {% endfor %}
</div>

{% if year in summary.margins_by_year %}
{% set margin = summary.margins_by_year[year] %}
<div class="metrics">
    <div class="metric">
        <div class="metric-value {% if margin.margin > 0 %}r{% else %}d{% endif %}">
            {% if margin.margin > 0 %}R+{% else %}D+{% endif %}{{ "%.1f"|format(margin.margin|abs) }}%
        </div>
        <div class="metric-label">Overall Margin</div>
    </div>
    <div class="metric">
        <div class="metric-value r">{{ "{:,}".format(margin.r_votes) }}</div>
        <div class="metric-label">Republican Votes</div>
    </div>
    <div class="metric">
        <div class="metric-value d">{{ "{:,}".format(margin.d_votes) }}</div>
        <div class="metric-label">Democratic Votes</div>
    </div>
    <div class="metric">
        <div class="metric-value">{{ "{:,}".format(margin.total_votes) }}</div>
        <div class="metric-label">Total Votes</div>
    </div>
</div>
{% endif %}

<div class="section">
    <h2>Race Results</h2>

    {% for race in races %}
    <div class="election-year">
        <div class="election-year-header">
            <h3>{{ race.office }}{% if race.district %} - District {{ race.district }}{% endif %}</h3>
            <span class="{% if race.winner_party == 'R' %}r{% elif race.winner_party == 'D' %}d{% endif %}">
                {% if race.winner_party == 'R' %}R+{% elif race.winner_party == 'D' %}D+{% endif %}{{ "%.1f"|format(race.margin_pct|abs) }}%
            </span>
        </div>
        <ul class="candidates">
            {% for c in race.candidates %}
            <li class="candidate {% if c.is_winner %}winner{% endif %}">
                <span class="candidate-name">{{ c.name }}</span>
                <span class="candidate-party {% if c.party == 'Republican' %}r{% elif c.party == 'Democratic' %}d{% endif %}">{{ c.party or '-' }}</span>
                <span class="candidate-votes">{{ "{:,}".format(c.votes) }}</span>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endfor %}
</div>
{% endblock %}
