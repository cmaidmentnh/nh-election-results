{% extends "base.html" %}

{% block title %}Trump vs State Rep Performance - NH Election Results{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Trump vs State Rep Performance</h1>
    <p class="subtitle">2024: Comparing presidential and State House margins by district</p>
</div>

<div class="metrics">
    <div class="metric">
        <div class="metric-value">{{ underperformers|length }}</div>
        <div class="metric-label">R Underperformed</div>
    </div>
    <div class="metric">
        <div class="metric-value">{{ outperformers|length }}</div>
        <div class="metric-label">R Outperformed</div>
    </div>
    <div class="metric">
        <div class="metric-value {% if avg_gap > 0 %}r{% else %}d{% endif %}">{{ "%+.1f"|format(avg_gap) }}</div>
        <div class="metric-label">Avg R vs Trump</div>
    </div>
</div>

<div class="section">
    <h2>R Candidates Who Underperformed Trump ({{ underperformers|length }})</h2>
    <p class="text-muted mb-2">Districts where R State Rep margin was worse than Trump's margin</p>

    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>District</th>
                <th>Towns</th>
                <th>Trump</th>
                <th>State Rep</th>
                <th>Gap</th>
                <th>R Candidates</th>
            </tr>
        </thead>
        <tbody>
            {% for r in underperformers %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>
                    <a href="{{ url_for('district', county=r.county, district=r.district) }}">{{ r.county }} {{ r.district }}</a>
                </td>
                <td class="text-muted" style="font-size: 0.85rem; max-width: 200px;">{{ r.towns }}</td>
                <td class="{% if r.trump > 0 %}r{% else %}d{% endif %}">
                    {% if r.trump > 0 %}R+{% else %}D+{% endif %}{{ "%.1f"|format(r.trump|abs) }}
                </td>
                <td class="{% if r.rep > 0 %}r{% else %}d{% endif %}">
                    {% if r.rep > 0 %}R+{% else %}D+{% endif %}{{ "%.1f"|format(r.rep|abs) }}
                </td>
                <td><strong>{{ "%+.1f"|format(r.gap) }}</strong></td>
                <td style="font-size: 0.85rem;">{{ r.r_candidates|join(', ') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="section">
    <h2>R Candidates Who Outperformed Trump ({{ outperformers|length }})</h2>
    <p class="text-muted mb-2">Districts where R State Rep margin was better than Trump's margin</p>

    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>District</th>
                <th>Towns</th>
                <th>Trump</th>
                <th>State Rep</th>
                <th>Gap</th>
                <th>R Candidates</th>
            </tr>
        </thead>
        <tbody>
            {% for r in outperformers %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>
                    <a href="{{ url_for('district', county=r.county, district=r.district) }}">{{ r.county }} {{ r.district }}</a>
                </td>
                <td class="text-muted" style="font-size: 0.85rem; max-width: 200px;">{{ r.towns }}</td>
                <td class="{% if r.trump > 0 %}r{% else %}d{% endif %}">
                    {% if r.trump > 0 %}R+{% else %}D+{% endif %}{{ "%.1f"|format(r.trump|abs) }}
                </td>
                <td class="{% if r.rep > 0 %}r{% else %}d{% endif %}">
                    {% if r.rep > 0 %}R+{% else %}D+{% endif %}{{ "%.1f"|format(r.rep|abs) }}
                </td>
                <td class="r"><strong>{{ "%+.1f"|format(r.gap) }}</strong></td>
                <td style="font-size: 0.85rem;">{{ r.r_candidates|join(', ') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
