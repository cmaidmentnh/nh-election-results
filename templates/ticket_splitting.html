{% extends "base.html" %}

{% block title %}Ticket Splitting - NH Election Results{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Ticket Splitting Analysis</h1>
    <p class="subtitle">Towns where voters split between President and State Representative</p>
</div>

<div class="metrics">
    <div class="metric">
        <div class="metric-value">{{ data.total_splits }}</div>
        <div class="metric-label">Total Split Towns</div>
    </div>
    {% for year, splits in data.by_year.items()|sort(reverse=true) %}
    <div class="metric">
        <div class="metric-value">{{ splits|length }}</div>
        <div class="metric-label">{{ year }} Splits</div>
    </div>
    {% endfor %}
</div>

<div class="two-col">
    <div class="main-content">
        <div class="section">
            <h2>Ticket Splitting by Year</h2>
            <p class="text-muted mb-2">Towns where the presidential winner differed from state rep majority</p>

            {% for year in data.by_year.keys()|sort(reverse=true) %}
            <div class="election-year">
                <div class="election-year-header">
                    <h3>{{ year }}</h3>
                    <span>{{ data.by_year[year]|length }} towns</span>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Town</th>
                            <th class="text-right">President</th>
                            <th class="text-right">State Rep</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for s in data.by_year[year][:20] %}
                        <tr>
                            <td><a href="{{ url_for('town', name=s.town) }}">{{ s.town }}</a></td>
                            <td class="text-right">
                                <span class="{% if s.president == 'R' %}r{% else %}d{% endif %}">
                                    {{ s.president }}{% if s.president_margin > 0 %}+{% endif %}{{ "%.1f"|format(s.president_margin) }}%
                                </span>
                            </td>
                            <td class="text-right">
                                <span class="{% if s.state_rep == 'R' %}r{% else %}d{% endif %}">
                                    {{ s.state_rep }}{% if s.state_rep_margin > 0 %}+{% endif %}{{ "%.1f"|format(s.state_rep_margin) }}%
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endfor %}
        </div>
    </div>

    <aside class="sidebar">
        <div class="sidebar-section">
            <h3>What is Ticket Splitting?</h3>
            <p class="text-muted">Ticket splitting occurs when voters choose candidates from different parties for different offices in the same election. This analysis shows towns where the presidential winner was from a different party than the majority of state representative votes.</p>
        </div>

        <div class="sidebar-section">
            <h3>Key Insight</h3>
            <p class="text-muted">Towns with frequent ticket splitting are often true swing areas where candidate quality and local issues matter more than party affiliation.</p>
        </div>
    </aside>
</div>
{% endblock %}
